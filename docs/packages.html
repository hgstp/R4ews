<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Kapitel 13 Pakete | R4ews MA0009</title>
<meta name="author" content="Stephan Haug">
<meta name="description" content="Bei einem Paket handelt es sich um eine strukturierte, standardisierte Einheit, welche aus R Code, Dokumentation, Daten und (möglicherweise) externem Quellcode besteht. Wie man ein Paket...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Kapitel 13 Pakete | R4ews MA0009">
<meta property="og:type" content="book">
<meta property="og:description" content="Bei einem Paket handelt es sich um eine strukturierte, standardisierte Einheit, welche aus R Code, Dokumentation, Daten und (möglicherweise) externem Quellcode besteht. Wie man ein Paket...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kapitel 13 Pakete | R4ews MA0009">
<meta name="twitter:description" content="Bei einem Paket handelt es sich um eine strukturierte, standardisierte Einheit, welche aus R Code, Dokumentation, Daten und (möglicherweise) externem Quellcode besteht. Wie man ein Paket...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Lato-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet">
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet">
<script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="anchor-links.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-68219208-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-68219208-1');
      </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="r4ews.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R4ews MA0009</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">R4ews</a></li>
<li class="book-part">R, wie fange ich an</li>
<li><a class="" href="install.html"><span class="header-section-number">1</span> Installieren von R und RStudio</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">2</span> R Basics und Arbeitsabläufe</a></li>
<li class="book-part">Versionskontrolle und R Markdown</li>
<li><a class="" href="version-control.html"><span class="header-section-number">3</span> Git, GitHub, and RStudio</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">4</span> R Markdown</a></li>
<li class="book-part">Datenanalyse Intro</li>
<li><a class="" href="basic-data-care.html"><span class="header-section-number">5</span> Letzte Vorbereitungen …</a></li>
<li><a class="" href="dplyr-intro.html"><span class="header-section-number">6</span> Einführung in dplyr</a></li>
<li><a class="" href="dplyr-single.html"><span class="header-section-number">7</span> Mehr zu dplyr</a></li>
<li><a class="" href="import-export.html"><span class="header-section-number">8</span> Daten I/O</a></li>
<li><a class="" href="tidy.html"><span class="header-section-number">9</span> tidy was?</a></li>
<li class="book-part">ggplot2 Intro</li>
<li><a class="" href="graphics-overview.html"><span class="header-section-number">10</span> Einführung</a></li>
<li><a class="" href="bausteine.html"><span class="header-section-number">11</span> Bausteine</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="fragen.html"><span class="header-section-number">12</span> Fragen aus der Übung</a></li>
<li class="book-part">Noch viel mehr möglich</li>
<li><a class="active" href="packages.html"><span class="header-section-number">13</span> Pakete</a></li>
<li><a class="" href="funktionen.html"><span class="header-section-number">14</span> Funktionen</a></li>
<li><a class="" href="envscop.html"><span class="header-section-number">15</span> Environments und Scoping</a></li>
<li><a class="" href="literatur-3.html">Literatur</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="packages" class="section level1" number="13">
<h1>
<span class="header-section-number">Kapitel 13</span> Pakete<a class="anchor" aria-label="anchor" href="#packages"><i class="fas fa-link"></i></a>
</h1>
<p>Bei einem Paket handelt es sich um</p>
<blockquote>
<p>eine strukturierte, standardisierte Einheit, welche aus R Code, Dokumentation, Daten und (möglicherweise) externem Quellcode besteht.</p>
</blockquote>
<p>Wie man ein Paket installiert und lädt, ist uns mittlerweile bekannt. Jetzt wollen wir eigene Pakete erstellen.</p>
<p>Gute Gründe für die Verwendung von Paketen:</p>
<ul>
<li><p>dynamisches Laden und Entladen des Pakets (Speicherplatz
sparend)</p></li>
<li><p>einfache Installation und Update von lokalen Datenträgern oder über
das Web, innerhalb von R oder über die Kommandozeile des
Betriebssystems</p></li>
<li><p>Validierung: R bietet Befehle zur groben Überprüfung von Code,
Dokumentation und Installierbarkeit, sowie, falls man möchte,
Überprüfung von Berechnungsergebnissen.</p></li>
<li><p>einfache Verteilung der Software an Dritte; Beispieldatensätze können auch ins Paket!</p></li>
</ul>
<div id="struktur" class="section level2" number="13.1">
<h2>
<span class="header-section-number">13.1</span> Struktur<a class="anchor" aria-label="anchor" href="#struktur"><i class="fas fa-link"></i></a>
</h2>
<p>Ein Paket besteht aus einigen Standard–Dateien und Verzeichnissen:</p>
<ul>
<li>
<code>DESCRIPTION</code>: Informationen über das Paket (Autor,
Lizenz, Titel, Abhängigkeiten, …)</li>
<li>
<code>R/</code>: R Code in <code>.R</code> Dateien</li>
<li>
<code>man/</code>: Dokumentationen (im <code>*.Rd</code> Format) der einzelnen Funktionen</li>
<li>
<code>NAMESPACE</code>: Information über die zu “exportierenden” Funktionen</li>
<li>
<code>data/</code>: Datenbeispiele</li>
<li>
<code>src/</code>: kompilierter C, C++ oder Fortran Code</li>
<li>
<code>tests/</code>: Testroutinen zur Validierung des Pakets</li>
</ul>
<p>Bei der Erzeugung der Struktur (wie auch weiteren Schritten bei der Entwicklung) sollte man so viel wie möglich automatisieren. Wir verwenden dazu die von Hadley Wickham bereitgestellten Werkzeuge.</p>
<p>Falls noch nicht geschehen, sollte man</p>
<div class="sourceCode" id="cb179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"devtools"</span>, <span class="st">"roxygen2"</span>, <span class="st">"testthat"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>ausführen. Diese Pakete erleichtern in Kombination mit RStudio das Erstellen von Paketen.</p>
</div>
<div id="c-compiler" class="section level2" number="13.2">
<h2>
<span class="header-section-number">13.2</span> C Compiler<a class="anchor" aria-label="anchor" href="#c-compiler"><i class="fas fa-link"></i></a>
</h2>
<p>Um alle Möglichkeiten bei der Erstellung von R-Paketen ausnützen zu können, brauchst du außerdem einen Compiler und noch ein paar andere Werkzeuge. Dies ist aber vermutlich erst dann wirklich nötig, wenn du Pakete bauen willst, die C- oder C++-Code enthalten (nicht Teil des Kurses). RStudio sollte dich auch warnen und dir Unterstützung anbieten, sobald du versuchen solltest, etwas zu tun, das die Einrichtung einer Entwicklungsumgebung erfordert.</p>
<p>Mit <code><a href="https://rdrr.io/pkg/pkgbuild/man/has_compiler.html">has_devel()</a></code> kannst du aber bereits auch jetzt mal überprüfen ob dein System vielleicht schon bereit ist</p>
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/">devtools</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/pkgbuild/man/has_compiler.html">has_devel</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">## Your system is ready to build packages!</span></code></pre></div>
<p>Dies scheint bei mir der Fall zu sein.</p>
</div>
<div id="r-code" class="section level2" number="13.3">
<h2>
<span class="header-section-number">13.3</span> R Code<a class="anchor" aria-label="anchor" href="#r-code"><i class="fas fa-link"></i></a>
</h2>
<p>Das Verzeichnis <code>R/</code> ist der wichtigste Bestandteil eines Pakets, da dort der komplette R Code liegt.
Dieses Verzeichnis (wie auch andere Teile) erzeugt man mit der Funktion <code><a href="https://devtools.r-lib.org/reference/create.html">devtools::create()</a></code>, z.B.</p>
<div class="sourceCode" id="cb182"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://devtools.r-lib.org/reference/create.html">create</a></span><span class="op">(</span><span class="st">"Pfad_zum_Paket/Paketname"</span><span class="op">)</span></code></pre></div>
<p>Dieser Befehl erzeugt das Verzeichnis <code>Pfad_zum_Paket/Paketname</code>, welches</p>
<ol style="list-style-type: decimal">
<li>eine RStudio Projektdatei, <code>Paketname.Rproj</code>
</li>
<li>ein <code>R/</code> Verzeichnis</li>
<li>eine <code>DESCRIPTION</code> Datei</li>
<li>eine <code>NAMESPACE</code> Datei</li>
</ol>
<p>enthält. Allen R Code, der im Paket enthalten sein soll, kopiert man anschließend in das Verzeichnis <code>Pfad_zum_Paket/Paketname/R</code>.</p>
<p>Innerhalb eines Pakets ist es nun einfach den kompletten R Code (nach Änderungen) neu zu laden.</p>
<ul>
<li>
<code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all()</a></code> lädt allen R Code neu. In RStudio auch über <strong>Strg + Shift + L</strong> möglich.</li>
<li>In RStudio kann man mit <strong>Strg + Shift + B</strong> das Paket installieren, R neu starten und anschließend das Paket über <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> neu laden.</li>
</ul>
<p>Dadurch ergibt sich der folgende Arbeitsablauf</p>
<ol style="list-style-type: decimal">
<li>R Dateien im Editor bearbeiten</li>
<li>Strg + Shift + L (oder Strg + Shift + B) ausführen</li>
<li>Code in der Konsole überprüfen</li>
<li>Das Ganze (falls nötig) wiederholen</li>
</ol>
</div>
<div id="verschiedene-typen" class="section level2" number="13.4">
<h2>
<span class="header-section-number">13.4</span> Verschiedene Typen<a class="anchor" aria-label="anchor" href="#verschiedene-typen"><i class="fas fa-link"></i></a>
</h2>
<p>Man unterscheidet fünf verschiedene Typen: <em>source, bundled, binary, installed</em> und <em>in memory</em>.</p>
<ul>
<li><p><strong>source</strong>: Die source Version eines Pakets besteht aus dem Verzeichnis <code>Paketname</code></p></li>
<li><p><strong>bundled</strong>: Komprimiert man das Verzeichnis in eine <code>.tar.gz</code> Datei so spricht man von einem “gebündelten” Paket. Dieser Typ stellt eher einen Zwischenschritt dar. Mit <code><a href="https://devtools.r-lib.org/reference/build.html">devtools::build()</a></code> kann aber eine solche Version erzeugt werden. Weitere Unterschiede zu einer source Version sind für uns erst mal nicht von Interesse.</p></li>
<li><p><strong>binary</strong>: Ein gebündeltes Paket kann von anderen R Nutzern nur installiert werden, wenn sie selbst über die entsprechenden “Werkzeuge” (Rtools, …) verfügen. Binary Pakete bestehen auch nur aus einer Datei, können aber von anderen R Nutzern auch ohne weitere “Werkzeuge” installiert werden. Allerdings sind binary Pakete plattformspezifisch. Ein Windows binary Paket kann also z.B. nicht auf einem Mac installiert werden. Erzeugt wird eine binary Version z.B. mit <code><a href="https://devtools.r-lib.org/reference/build.html">devtools::build(binary = TRUE)</a></code>.</p></li>
<li>
<p><strong>installed</strong>: Ein installiertes Paket ist ein in eine R Library entpacktes binary Paket. Zu diesem Zustand kann man über mehrere Wege gelangen, z.B.</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages()</a></code>: CRAN binary -&gt; installed</li>
<li>
<code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages(type = source)</a></code>: CRAN source -&gt; bundled -&gt; installed</li>
<li>
<code><a href="https://devtools.r-lib.org/reference/install.html">install()</a></code>: source -&gt; installed</li>
</ul>
</li>
</ul>
<p>Mit <code><a href="https://devtools.r-lib.org/reference/remote-reexports.html">devtools::install_github()</a></code> können source Pakete aus eine <a href="https://github.com/">GitHub</a> Projekt installiert werden.</p>
<ul>
<li>
<strong>in memory</strong>: Um mit einem Paket zu arbeiten muss es in den Speicher geladen werden. Dies geschieht mit <code><a href="https://rdrr.io/r/base/library.html">library()</a></code> (installierte Pakete) oder <code><a href="https://devtools.r-lib.org/reference/load_all.html">load_all()</a></code> (beim Entwickeln von Paketen).</li>
</ul>
</div>
<div id="description" class="section level2" number="13.5">
<h2>
<span class="header-section-number">13.5</span> DESCRIPTION<a class="anchor" aria-label="anchor" href="#description"><i class="fas fa-link"></i></a>
</h2>
<p>Die DESCRIPTION Datei enthält Informationen über das Paket und ist ein essentieller Bestandteil jedes Pakets. Der Befehl</p>
<div class="sourceCode" id="cb183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/create_package.html">create_package</a></span><span class="op">(</span><span class="st">"meinR4EWSpckg"</span><span class="op">)</span></code></pre></div>
<p>erzeugt die DESCRIPTION Datei</p>
<pre><code>Package: meinR4EWSpckg
Type: Package
Title: What the Package Does (Title Case)
Version: 0.1.0
Author: Who wrote it
Maintainer: The package maintainer &lt;yourself@somewhere.net&gt;
Description: More about what it does (maybe more than one line)
    Use four spaces when indenting paragraphs within the Description.
License: What license is it under?
Encoding: UTF-8
LazyData: true</code></pre>
<p>im Ordner <code>meinR4EWSpckg</code>.</p>
<p>Die wichtigsten Felder einer DESCRIPTION Datei sind dadurch vorhanden (und müssen gefüllt werden). Über die Punkte <code>Imports</code> und <code>Suggests</code> (nicht automatisch vorhanden) kann festgelegt werden welche anderen R Pakete zwingend notwendig bzw. hilfreich sind für das eigene Paket.</p>
<p>Pakete in <code>Imports</code> werden beim Installieren des eigenen Pakets ebenfalls installiert, falls diese noch nicht vorhanden sind. Pakete in <code>Suggests</code> werden nicht automatisch installiert.</p>
<p>Über</p>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_package.html">use_package</a></span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></code></pre></div>
<p>kann z.B. das Paket <code>dplyr</code> dem Punkt <code>Imports</code> hinzugefügt werden. <code><a href="https://usethis.r-lib.org/reference/use_package.html">usethis::use_package(type = "Suggests")</a></code> fügt <code>Suggests</code> weitere Pakete hinzu.</p>
<div id="name-titel-beschreibung" class="section level3" number="13.5.1">
<h3>
<span class="header-section-number">13.5.1</span> Name, Titel, Beschreibung<a class="anchor" aria-label="anchor" href="#name-titel-beschreibung"><i class="fas fa-link"></i></a>
</h3>
<p>Der Name (<code>Package</code>) eines Pakets darf Buchstaben, Zahlen und <code>.</code> enthalten und sollte mit dem Verzeichnisname übereinstimmen.</p>
<p><code>Title</code> und <code>Description</code> sollten beschreiben was das Paket genau macht. <code>Description</code> ist dabei deutlich ausführlicher und enthält daher i.d.R. mehrere Zeilen. Nach einem Zeilenumbruch sollte 4 Leerzeichen eingerückt werden. Ein Beispiel wäre</p>
<pre><code>Title: An implementation of the Grammar of Graphics
Description: An implementation of the grammar of graphics in R. 
    It combines the advantages of both base and lattice graphics: 
    conditioning and shared axes are handled automatically, and 
    you can still build up a plot step by step from multiple data 
    sources. It also implements a sophisticated multidimensional 
    conditioning system and a consistent interface to map data 
    to aesthetic attributes. See the ggplot2 website for more 
    information, documentation and examples.</code></pre>
</div>
<div id="autoren" class="section level3" number="13.5.2">
<h3>
<span class="header-section-number">13.5.2</span> Autoren<a class="anchor" aria-label="anchor" href="#autoren"><i class="fas fa-link"></i></a>
</h3>
<p>Über das Feld <code>Authors@R</code> können die Autoren des Pakets angegeben werden. An dieser Stelle kann
in der DESCRIPTION Datei R Code verwendet werden um die nötigen Informationen</p>
<ul>
<li>
<code>given, family</code>: Vor- und Nachname</li>
<li>
<code>email</code>: E-Mailadresse</li>
<li>
<code>role</code>: Rolle der Person. Wichtige Beispiele sind
<ul>
<li>
<code>cre</code>: Ersteller oder Maintainer</li>
<li>
<code>aut</code>: hat wichtige Beiträge zum Paket erbracht</li>
<li>
<code>ctb</code>: hat kleinere Beiträge zum Paket erbracht</li>
</ul>
</li>
</ul>
<p>Mit der Funktion <code><a href="https://rdrr.io/r/utils/person.html">person()</a></code> können diese Informationen nun angegeben werden</p>
<pre><code>Authors@R: person(given = "Stephan", family = "Haug", 
                  email = "haug@tum.de", 
                  role = c("cre", "aut"))</code></pre>
<p>Der Output von <code><a href="https://rdrr.io/r/utils/person.html">person()</a></code> sieht dann folgendermaßen aus</p>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/person.html">person</a></span><span class="op">(</span>given <span class="op">=</span> <span class="st">"Stephan"</span>, family <span class="op">=</span> <span class="st">"Haug"</span>, 
                  email <span class="op">=</span> <span class="st">"haug@tum.de"</span>, 
                  role <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"cre"</span>, <span class="st">"aut"</span><span class="op">)</span><span class="op">)</span>
<span class="co">## [1] "Stephan Haug &lt;haug@tum.de&gt; [cre, aut]"</span></code></pre></div>
</div>
<div id="version" class="section level3" number="13.5.3">
<h3>
<span class="header-section-number">13.5.3</span> Version<a class="anchor" aria-label="anchor" href="#version"><i class="fas fa-link"></i></a>
</h3>
<p><code><a href="https://devtools.r-lib.org/reference/create.html">devtools::create()</a></code> legt die Default-Version auf <code>0.1.0</code> fest. Generell sollte die Versionsnummer aber aus drei Teilen bestehen und die Form <code>x.y.z</code> haben, wobei <code>x</code> die Nummer für größere Updates, <code>y</code> die Nummer für kleinere Updates und <code>z</code> die Nummer für Korrekturen ist.</p>
<p>Die aktuelle Version von <code>ggplot2</code> ist z.B.</p>
<div class="sourceCode" id="cb189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span>
<span class="co">## [1] '3.3.5'</span></code></pre></div>
<p>Für Pakete, die sich in der Entwicklung befinden, bietet es sich an noch einen vierten Teil anzufügen und mit der Versionsnummer <code>0.0.0.9000</code> zu starten.</p>
<p>Nach diesen Anpassung könnte die DESCRIPTION Datei also so aussehen</p>
<pre><code>Package: meinR4EWSpckg
Type: Package
Title: Paket zu R4ews, das ...
Version: 0.0.0.9000
Authors@R: person(given = "Stephan", family = "Haug", 
                  email = "haug@tum.de", 
                  role = c("cre", "aut"))
Description: Paket, das im Rahmen des R Projekts R4ews entstanden ist.
    Das Paket bietet ...
License: What license is it under?
Encoding: UTF-8
LazyData: true
Imports: 
    dplyr</code></pre>
<blockquote>
<p>Der Punkt Lizenz ist für erstmal nachgeordnet. Wer aber mehr über die Wahl einer passenden Lizenz erfahren möchte, den verweisen wir gerene auf das Kapitel <a href="https://r-pkgs.org/license.html">Licensing</a> in <a href="https://r-pkgs.org">R packages</a>.</p>
</blockquote>
</div>
</div>
<div id="pakete-dokumentation" class="section level2" number="13.6">
<h2>
<span class="header-section-number">13.6</span> Pakete: Dokumentation<a class="anchor" aria-label="anchor" href="#pakete-dokumentation"><i class="fas fa-link"></i></a>
</h2>
<p>Ein wichtiger Teil eines Pakets ist die ausreichende Dokumentation (wichtiger) Funktionen. Dokumentationen werden als <code>.Rd</code> (LaTeX ähnliches Format) Dateien im Verzeichnis <code>man/</code> abgelegt. Das Paket <code>roxygen2</code> bietet eine komfortable Möglichkeit aus Funktionskommentaren (in einem speziellen Format) eine <code>.Rd</code> Datei zu erzeugen.</p>
<p><em>Ablauf:</em></p>
<ol style="list-style-type: decimal">
<li>roxygen Kommentare in die <code>.R</code> Datei einfügen</li>
<li>
<code><a href="https://devtools.r-lib.org/reference/document.html">devtools::document()</a></code> ausführen um Kommentare in <code>.Rd</code> Datei zu konvertieren</li>
<li>Dokumentation mit <code><a href="https://rdrr.io/r/utils/Question.html">?</a></code> betrachten</li>
<li>gegebenenfalls alles wiederholen</li>
</ol>
<p>roxygen Kommentare beginnen mit <code>#'</code>.</p>
<p>Wir fügen eine Datei <code>add_2.R</code> mit Inhalt</p>
<pre><code>#' Addiere zwei Zahlen
#' 
#' @param x Eine Zahl.
#' @param y Eine Zahl.
#' @return Die Summe von \code{x} und \code{y}.
#' @examples
#' add_2(1, 1)
#' add_2(10, 1)
add_2 &lt;- function(x, y) {
  x + y
}</code></pre>
<p>dem Verzeichnis <code>meinR4EWSpckg/R</code> hinzu.</p>
<p>Der Befehl <code><a href="https://devtools.r-lib.org/reference/document.html">devtools::document()</a></code> (ausgeführt im Verzeichnis <code>meinR4EWSpckg</code> - source Paket) erzeugt dann die Datei <code>meinR4EWSpckg/man/add_2.Rd</code></p>
<pre><code>% Generated by roxygen2 (4.0.2): do not edit by hand
\name{add_2}
\alias{add_2}
\title{Addiere zwei Zahlen}
\usage{
add_2(x, y)
}
\arguments{
\item{x}{Eine Zahl.}

\item{y}{Eine Zahl.}
}
\value{
Die Summe von \code{x} und \code{y}.
}
\description{
Addiere zwei Zahlen
}
\examples{
add_2(1, 1)
add_2(10, 1)
}
</code></pre>
<p>Alle roxygen Kommentare beginnen mit <code>#'</code> und sind unterteilt in verschiedene Tags der Form <code>@name_tag beschreibung</code>. Vor dem ersten Tag kommen allerdings</p>
<ul>
<li>Titel: erste Zeile des Kommentars</li>
<li>Beschreibung der Funktion: zweiter Abschnitt des Kommentars (länger als Titel)</li>
<li>Details zur Funktion: dritter Abschnitt des Kommentars (länger als die Beschreibung) - optional</li>
</ul>
<p>In unserem Beispiel wurde der Titel auch gleich als Beschreibung (da nicht explizit angegeben) verwendet.</p>
<p>Die drei wichtigsten Tags zum Kommentieren einer Funktion sind: <code>@param, @examples</code> und <code>@return</code>.
Weitere Tags sind im Abschnitt <a href="http://r-pkgs.had.co.nz/man.html#man-functions">Documenting functions</a> des Buchs <a href="https://r-pkgs.org">R packages</a> beschrieben.</p>
<p>Mit den Befehlen <code>\emph{}, \strong{}</code>, <code>\code{}</code> und <code>\pkg{}</code> (Paketname) kann der Text formatiert werden.</p>
<p>Ebenso können Links zu anderen Dokumentationen</p>
<ul>
<li>
<code>\code{\link{function}}</code>: Funktion <code>function</code> im eigenen Paket</li>
<li>
<code>\code{\link[devtools]{load_all}}</code>: Funktionen aus anderen Paketen, hier <code><a href="https://devtools.r-lib.org/reference/load_all.html">devtools::load_all</a></code>
</li>
</ul>
<p>oder dem Netz</p>
<ul>
<li><code>\url{http://rstudio.com}</code></li>
<li><code>\href{http://rstudio.com}{RStudio}</code></li>
<li>
<code>\email{haug@@tum.de}</code> (<code>@@</code> ist nötig, da <code><a href="https://rdrr.io/r/base/slotOp.html">@</a></code> für die Tags reserviert ist)</li>
</ul>
<p>Weitere Möglichkeiten der Formatierung findest du im Abschnitt <a href="http://r-pkgs.had.co.nz/man.html#text-formatting">Text formatting</a> des Buch <a href="https://r-pkgs.org">R packages</a>.</p>
</div>
<div id="namespace" class="section level2" number="13.7">
<h2>
<span class="header-section-number">13.7</span> NAMESPACE<a class="anchor" aria-label="anchor" href="#namespace"><i class="fas fa-link"></i></a>
</h2>
<p>Es ist nicht nur für das Erstellen von Paketen hilfreich das Konzept eines <code>NAMESPACE</code> verstanden zu haben, sondern auch für das generelle Arbeiten mit R. Man unterscheidet dabei <strong>Import</strong> <code>NAMESPACES</code> und <strong>Export</strong> <code>NAMESPACES</code>.</p>
<p><strong>Import</strong> legt dabei fest wie die Funktion eines Pakets eine Funktion in einem anderen Paket findet. Betrachten wir z.B.</p>
<div class="sourceCode" id="cb193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nrow</span>
<span class="co">## function (x) </span>
<span class="co">## dim(x)[1L]</span>
<span class="co">## &lt;bytecode: 0x7fbc935101d8&gt;</span>
<span class="co">## &lt;environment: namespace:base&gt;</span></code></pre></div>
<p>Diese Funktion ist definiert in Abhängigkeit von <code><a href="https://rdrr.io/r/base/dim.html">dim()</a></code> aus dem <code>base</code> Paket.</p>
<p>Auch wenn wir die Funktion</p>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>
<span class="co">## [1] 1 1</span></code></pre></div>
<p>definieren, findet <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code> trotzdem die “richtige” Funktion</p>
<div class="sourceCode" id="cb195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>
<span class="co">## [1] 32</span></code></pre></div>
<p>da sie den <code>NAMESPACE</code> des <code>base</code> Pakets verwendet.</p>
<p><strong>Export</strong> legt fest welche Funktionen eines Pakets außerhalb des Pakets zur Verfügung stehen sollen. Dies müssen/sollten nicht alle Funktionen sein. Ein Paket kann also interne Funktionen haben, die nur intern verwendet werden können.</p>
<p>Über den Operator <code><a href="https://rdrr.io/r/base/ns-dblcolon.html">::</a></code> wird explizit auf den NAMESPACE eines Pakets zugegriffen. Auf diese Art und Weise vermeidet man auch Konflikte zwischen Funktionen aus verschiedenen Paketen, die aber den gleichem Namen haben. In einem solchen Fall kommt es darauf an welches Paket zuletzt geladen wurde. Dieses findet man dann zuerst im Suchpfad</p>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">##  [1] ".GlobalEnv"        "package:devtools"  "package:usethis"  </span>
<span class="co">##  [4] "package:stats"     "package:graphics"  "package:grDevices"</span>
<span class="co">##  [7] "package:utils"     "package:datasets"  "package:methods"  </span>
<span class="co">## [10] "Autoloads"         "package:base"</span></code></pre></div>
<p>In der <code>NAMESPACE</code> Datei beschreiben</p>
<ul>
<li>
<code>export()</code>: exportiert Funktionen</li>
<li>
<code>exportPattern()</code>: exportiert alle Funktionen, die zu einem bestimmten Schema passen</li>
<li>
<code>S3method()</code>: exportiert <code>S3</code> Methoden</li>
</ul>
<p>den Export und</p>
<ul>
<li>
<code>import()</code>: importiert alle Funktionen aus einem Paket</li>
<li>
<code>importFrom()</code>: importiert eine bestimmte Funktion aus einem Paket</li>
<li>
<code>useDynLib()</code>: importiert eine Funktion aus C</li>
</ul>
<p>den Import.</p>
<p>Export-Einträge in der <code>NAMESPACE</code> Datei können leicht über <code>roxygen</code> Kommentare erzeugt werden.
Über einen <code>@export</code> Tag wird angegeben welche Funktion exportiert werden soll</p>
<pre><code>#' @export
export_function &lt;- function(...){
  ... 
}</code></pre>
<p>Je nach Objekttyp wird dann <code>export(), exportPattern()</code> oder <code>S3method()</code> im <code>NAMESPACE</code> verwendet. Generell sollte man sich an die Regel halten lieber weniger als mehr Funktionen zu exportieren, wenn man das Paket an Dritte weitergeben will.</p>
<p>Beim Importieren sollte man noch restriktiver sein. Man sollte über <code>Imports</code> in der <code>DESCRIPTION</code> Datei sicherstellen, dass alle notwendigen Pakete installiert und geladen sind. Danach kann einfach über den <code><a href="https://rdrr.io/r/base/ns-dblcolon.html">::</a></code> Operator in eigenen Funktionen auf Funktionen aus anderen geladenen Paketen zugegriffen werden, also z.B. <code>pkg_name::funktion_aus_pkg_name()</code>.</p>
<p>Dies erhöht die spätere Lesbarkeit der eigenen Programme und vermeidet potentielle Konflikte, die beim Importieren mehrerer Pakete - die dann wieder Funktionen mit gleichem Namen besitzen - auftreten können.</p>
<p>Muss eine Funktion häufig verwendet werden - und man will nicht dauernd <code><a href="https://rdrr.io/r/base/ns-dblcolon.html">::</a></code> verwenden - so sollte man über <code>importFrom()</code> eher nur die Funktion und nicht das ganze Paket importieren.</p>
</div>
<div id="daten-einbinden" class="section level2" number="13.8">
<h2>
<span class="header-section-number">13.8</span> Daten einbinden<a class="anchor" aria-label="anchor" href="#daten-einbinden"><i class="fas fa-link"></i></a>
</h2>
<p>Daten, die das Paket enthalten sollte, legt man im Verzeichnis <code>/data</code> ab. Als Format sollte man <code>.rda</code> wählen (ist aber kein Muss). Der einfachste Weg dies zu berücksichtigen ist die Funktion <code><a href="https://usethis.r-lib.org/reference/use_data.html">usethis::use_data()</a></code> zu verwenden.</p>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">50</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_data.html">use_data</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">mtcars</span><span class="op">)</span></code></pre></div>
<p>Dieser Befehl speichert die Objekte <code>x</code> und <code>mtcars</code> in den Dateien <code>data/x.rda</code> und <code>data/mtcars.rda</code> ab. Der Dateiname stimmt also mit dem Objektnamen überein.</p>
<p>Datensätze sollten auf jeden Fall dokumentiert werden. Dazu fügt man einfach in eine der <code>.R</code> Dateien im Verzeichnis <code>/R</code> einen weiteren <code>roxygen2</code> Absatz ein. Für das Dokumentieren von Datensätzen stehen zwei weitere Tags bereit. Über <code>@format</code> beschreibt man das genaue Format der Daten, z.B. die einzelnen Spalten eines Data Frames, und mit <code>@source</code> gibt man (falls vorhanden) die Datenquelle an.</p>
<p>Die Beschreibung des Datensatzes <code>x</code> könnte also z.B. so aussehen</p>
<pre><code>#' Mein Datensatz
#' 
#' Ein Datensatz bestehend aus 50 Zahlen gezogen aus den 
#' Zahlen 1 bis 100 mit Zuruecklegen
#' 
#' @format Ein Integer Vektor der Laenge 50
"x"</code></pre>
</div>
<div id="c-special-topic" class="section level2" number="13.9">
<h2>
<span class="header-section-number">13.9</span> C++ (Special Topic)<a class="anchor" aria-label="anchor" href="#c-special-topic"><i class="fas fa-link"></i></a>
</h2>
<p>Will man in seinem Paket R Funktionen verwenden, die mithilfe von <code>Rcpp</code> aus kompiliertem C++ Code entstanden sind, so sollte man zur Vorbereitung</p>
<div class="sourceCode" id="cb200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_rcpp.html">use_rcpp</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>ausführen. Danach ist das das Verzeichnis <code>/src</code> angelegt und <code>Rcpp</code> zu den Feldern <code>LinkingTo</code> und <code>Imports</code> in der <code>DESCRIPTION</code> Datei hinzugefügt. Außerdem wird man aufgefordert die roxygen Tags</p>
<pre><code>#' @useDynLib meinR4EWSpckg
#' @importFrom Rcpp sourceCpp</code></pre>
<p>in eine der <code>.R</code> Dateien einzufügen.</p>
<p>Ebenso wie in die <code>.R</code> Dateien kann auch in die <code>.cpp</code> Dateien die roxygen Dokumentation eingefügt werden. Allerdings verwendet man <code>//'</code> statt <code>#'</code>.</p>
<pre><code>#include &lt;Rcpp.h&gt;
using namespace Rcpp;

//' Multipliziere eine Zahl mit 2
//' 
//' @param x Ein Integer.
//' @export
// [[Rcpp::export]]
int malZwei(int x) {
   return x * 2;
}</code></pre>
</div>
<div id="git-und-githubgitlab" class="section level2" number="13.10">
<h2>
<span class="header-section-number">13.10</span> Git und GitHub/GitLab<a class="anchor" aria-label="anchor" href="#git-und-githubgitlab"><i class="fas fa-link"></i></a>
</h2>
<p>Benutze für jedes deiner Pakete (mag es auch noch so klein sein) Git. Beim Anlegen des Projekts (zur Erstellung des Pakets) über RStudio, kann leicht ein lokales Git repository initialisiert werden</p>
<div class="inline-figure"><img src="img/package_git.png" width="80%" style="display: block; margin: auto;"></div>
<p>Soll zusätzlich ein remote repository verwendet werden, so kann man (im Standardfall) ein neues repository auf GitLab (oder GitHub) anlegen. Es sollte den gleichen Namen bekommen wie das Paket (lokales Git repository). Danach kannst du im Terminal Befehle der Form</p>
<pre><code>git remote add origin https://gitlab.lrz.de/vw99xyz/paketName.git
git push -u origin master</code></pre>
<p>ausführen.</p>
<p>Angenommen es existiert bereits ein remote repository und das Paket soll dort “verwaltet” werden. Dann kannst du einfach dieses repository klonen</p>
<pre><code>git clone https://gitlab.lrz.de/vw99xyz/paketName.git</code></pre>
<p>Danach existiert im Verzeichnis, in dem der Befehl ausgeführt wurde, das Unterverzeichnis <code>paketName</code>. In R kannst du anschließend den Befehl</p>
<div class="sourceCode" id="cb205"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/create.html">create</a></span><span class="op">(</span><span class="st">"paketName"</span><span class="op">)</span></code></pre></div>
<p>ausführen (im Verzeichnis, welches das Git repository <code>paketName</code> enthält). Danach kannst du die Änderungen speichern über einen commit Befehl</p>
<pre><code>git add -A
git commit -m "paket struktur angelegt"</code></pre>
<p>und pushen</p>
<pre><code>git push</code></pre>
</div>
<div id="literatur-2" class="section level2" number="13.11">
<h2>
<span class="header-section-number">13.11</span> Literatur<a class="anchor" aria-label="anchor" href="#literatur-2"><i class="fas fa-link"></i></a>
</h2>
<p>Diese Folien haben einen kleinen Einblick in das Erstellen eigener Pakete gegeben. Allerdings wurden viele weitere Aspekte nicht angesprochen. Weitere Informationen zu R Paketen findet man z.B. im Buch <a href="http://r-pkgs.had.co.nz/">R packages</a> von Hadley Wickham <span class="citation">(<a href="literatur-3.html#ref-wickham2015b" role="doc-biblioref">2015b</a>)</span>.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="fragen.html"><span class="header-section-number">12</span> Fragen aus der Übung</a></div>
<div class="next"><a href="funktionen.html"><span class="header-section-number">14</span> Funktionen</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#packages"><span class="header-section-number">13</span> Pakete</a></li>
<li><a class="nav-link" href="#struktur"><span class="header-section-number">13.1</span> Struktur</a></li>
<li><a class="nav-link" href="#c-compiler"><span class="header-section-number">13.2</span> C Compiler</a></li>
<li><a class="nav-link" href="#r-code"><span class="header-section-number">13.3</span> R Code</a></li>
<li><a class="nav-link" href="#verschiedene-typen"><span class="header-section-number">13.4</span> Verschiedene Typen</a></li>
<li>
<a class="nav-link" href="#description"><span class="header-section-number">13.5</span> DESCRIPTION</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#name-titel-beschreibung"><span class="header-section-number">13.5.1</span> Name, Titel, Beschreibung</a></li>
<li><a class="nav-link" href="#autoren"><span class="header-section-number">13.5.2</span> Autoren</a></li>
<li><a class="nav-link" href="#version"><span class="header-section-number">13.5.3</span> Version</a></li>
</ul>
</li>
<li><a class="nav-link" href="#pakete-dokumentation"><span class="header-section-number">13.6</span> Pakete: Dokumentation</a></li>
<li><a class="nav-link" href="#namespace"><span class="header-section-number">13.7</span> NAMESPACE</a></li>
<li><a class="nav-link" href="#daten-einbinden"><span class="header-section-number">13.8</span> Daten einbinden</a></li>
<li><a class="nav-link" href="#c-special-topic"><span class="header-section-number">13.9</span> C++ (Special Topic)</a></li>
<li><a class="nav-link" href="#git-und-githubgitlab"><span class="header-section-number">13.10</span> Git und GitHub/GitLab</a></li>
<li><a class="nav-link" href="#literatur-2"><span class="header-section-number">13.11</span> Literatur</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R4ews MA0009</strong>" was written by Stephan Haug. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
