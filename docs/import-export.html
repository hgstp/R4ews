<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Kapitel 8 Daten I/O | R4ews MA0009</title>
<meta name="author" content="Stephan Haug">
<meta name="description" content="8.1 Ãœberblick Im letzten Abschnitt haben wir die Gapminder-Daten als tibble aus dem gapminder Paket geladen. Dabei haben wir dann weder Daten, noch abgeleitete Ergebnisse, explizit in eine Datei...">
<meta name="generator" content="bookdown 0.41 with bs4_book()">
<meta property="og:title" content="Kapitel 8 Daten I/O | R4ews MA0009">
<meta property="og:type" content="book">
<meta property="og:description" content="8.1 Ãœberblick Im letzten Abschnitt haben wir die Gapminder-Daten als tibble aus dem gapminder Paket geladen. Dabei haben wir dann weder Daten, noch abgeleitete Ergebnisse, explizit in eine Datei...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kapitel 8 Daten I/O | R4ews MA0009">
<meta name="twitter:description" content="8.1 Ãœberblick Im letzten Abschnitt haben wir die Gapminder-Daten als tibble aus dem gapminder Paket geladen. Dabei haben wir dann weder Daten, noch abgeleitete Ergebnisse, explizit in eine Datei...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Lato-0.4.9/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link href="libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="anchor-links.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-68219208-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-68219208-1');
      </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
          margin-bottom: 0em;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="r4ews.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R4ews MA0009</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">R4ews</a></li>
<li class="book-part">R, wie fange ich an</li>
<li><a class="" href="install.html"><span class="header-section-number">1</span> Installieren von R und RStudio</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">2</span> R Basics und ArbeitsablÃ¤ufe</a></li>
<li class="book-part">Versionskontrolle und R Markdown</li>
<li><a class="" href="version-control.html"><span class="header-section-number">3</span> Git, GitHub, and RStudio</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">4</span> R Markdown</a></li>
<li class="book-part">Datenanalyse Intro</li>
<li><a class="" href="data-intro.html"><span class="header-section-number">5</span> Letzte Vorbereitungen â€¦</a></li>
<li><a class="" href="dplyr-intro.html"><span class="header-section-number">6</span> EinfÃ¼hrung in dplyr</a></li>
<li><a class="" href="dplyr-single.html"><span class="header-section-number">7</span> Mehr zu dplyr</a></li>
<li><a class="active" href="import-export.html"><span class="header-section-number">8</span> Daten I/O</a></li>
<li><a class="" href="tidy.html"><span class="header-section-number">9</span> tidy was?</a></li>
<li class="book-part">ggplot2 Intro</li>
<li><a class="" href="einfuehrung-ggplot2.html"><span class="header-section-number">10</span> EinfÃ¼hrung</a></li>
<li><a class="" href="bausteine.html"><span class="header-section-number">11</span> Bausteine</a></li>
<li class="book-part">Wir schreiben ein Paket</li>
<li><a class="" href="pakete.html"><span class="header-section-number">12</span> Pakete</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="funktionen.html"><span class="header-section-number">13</span> Funktionen</a></li>
<li><a class="" href="envscop.html"><span class="header-section-number">14</span> Environments und Scoping</a></li>
<li><a class="" href="literatur-3.html">Literatur</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="import-export" class="section level1" number="8">
<h1>
<span class="header-section-number">Kapitel 8</span> Daten I/O<a class="anchor" aria-label="anchor" href="#import-export"><i class="fas fa-link"></i></a>
</h1>
<div id="Ã¼berblick" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Ãœberblick<a class="anchor" aria-label="anchor" href="#%C3%BCberblick"><i class="fas fa-link"></i></a>
</h2>
<p>Im letzten Abschnitt haben wir die Gapminder-Daten als tibble aus dem <a href="https://github.com/jennybc/gapminder">gapminder</a> Paket geladen. Dabei haben wir dann weder Daten, noch abgeleitete Ergebnisse, explizit in eine Datei geschrieben. Im wirklichen Leben werdet ihr aber stÃ¤ndig Daten, die in Tabellenform vorliegen, in R ein- und auslesen. Manchmal muss das sogar fÃ¼r Daten geschehen, die nicht in Tabellenform vorliegen.</p>
<blockquote>
<p>Wie macht man das? Worauf muss man aufpassen?</p>
</blockquote>
<div id="daten-import" class="section level3" number="8.1.1">
<h3>
<span class="header-section-number">8.1.1</span> Daten Import<a class="anchor" aria-label="anchor" href="#daten-import"><i class="fas fa-link"></i></a>
</h3>
<p>FÃ¼r das Importieren von Daten gibt es im Allgemeinen zwei Szenarien:</p>
<ul>
<li><p><em>â€œÃœberrasche mich!â€</em> Diese Haltung mÃ¼sst ihr einnehmen, wenn ihr einen Datensatz erhaltet und zum ersten Mal versucht diesen einzulesen. Man muss froh sein, wenn man die Daten ohne Fehlermeldung importieren kann. Im nÃ¤chsten Schritt schaut man sich das Ergebnis an und entdeckt vermutlich Fehler in den Daten und/oder beim Import. AnschlieÃŸend behebt man die Fehler und beginnt nochmal von vorne.</p></li>
<li><p><em>â€œEin weiterer Tag im Paradies.â€</em> Das wird vermutlich euer GefÃ¼hl sein, wenn ihr versucht einen <a href="tidy.html#tidy">aufgerÃ¤umten Datensatz</a> einzulesen (den jemand vorher in einem oder mehreren â€œReinigungsskriptenâ€ aufgerÃ¤umt hat). Beim Einlesen solcher Daten sollte es keine Ãœberraschungen geben.</p></li>
</ul>
<p>Im zweiten Fall, und im weiteren Verlauf des ersten Falles, lernt ihr tatsÃ¤chlich eine Menge darÃ¼ber, wie die Daten strukturiert sind/sein sollten.</p>
<div class="content-box-orange">
<p><strong>Ein wichtiger Import-Ratschlag:</strong> <em>Verwende die Argumente der Importfunktion, um so weit wie mÃ¶glich und so schnell wie mÃ¶glich zu kommen</em>. Macht man dies nicht, so sind oft nach dem Einlesen der Daten noch eine Reihe von weiteren Schritten nÃ¶tig, bevor man mit der eigentlichen Analyse beginnen kann. Daher lest die Hilfe zu den Importfunktionen und nutzt die Argumente maximal aus, um den Import zu steuern.</p>
</div>
</div>
<div id="daten-export" class="section level3" number="8.1.2">
<h3>
<span class="header-section-number">8.1.2</span> Daten Export<a class="anchor" aria-label="anchor" href="#daten-export"><i class="fas fa-link"></i></a>
</h3>
<p>Es wird viele Gelegenheiten geben, bei denen ihr Daten aus R exportieren wollt. Zwei wichtige Beispiele:</p>
<ul>
<li><p>einen gesÃ¤uberten Datensatz, der bereit ist analysiert zu werden</p></li>
<li><p>ein numerisches Ergebnis aus einer Datenaggregation oder Modellierung oder einer statistischen Schlussfolgerung</p></li>
</ul>
<div class="content-box-gray">
<p><strong>Erster Tipp:</strong> <em>Der Output von heute ist der Input von morgen</em>. Denkt an all die Schmerzen zurÃ¼ck, die ihr selbst beim Import von fremden Daten erlitten habt, und fÃ¼gt euch nicht selbst solche Schmerzen zu!</p>
<p><strong>Zweiter Tipp:</strong> Seid nicht zu clever. Eine einfache Textdatei, die von einem Menschen in einem Texteditor lesbar ist, sollte euer <em>Standard</em> sein, bis es <em>einen guten Grund</em> dafÃ¼r gibt, dass dies nicht ausreichend ist. Das Lesen und Schreiben in exotische Formate wird das Erste sein, was mÃ¶glicherweise in Zukunft oder auf einem anderen Computer nicht mehr funktioniert. Zudem schafft es Barrieren fÃ¼r jeden, der ein anderes Toolkit hat als ihr.</p>
</div>
<p>Wie passt das zu unserer Betonung der dynamischen Berichterstattung Ã¼ber R Markdown? Es gibt fÃ¼r alles eine Zeit und einen Ort. Es gibt Projekte und Dokumente, bei denen ihr euch intensiv mit <a href="https://github.com/yihui/knitr">knitr</a> und <a href="https://rmarkdown.rstudio.com/">rmarkdown</a> beschÃ¤ftigen kÃ¶nnt/wollt/mÃ¼sst. Aber es gibt viele gute GrÃ¼nde, warum (Teile) einer Analyse nicht (nur) in einen dynamischen Bericht eingebettet werden sollten. Vielleicht wollt ihr Daten bereinigen, um einen Datensatz fÃ¼r eine nachfolgende Analyse zu erzeugen. Vielleicht leistet ihr einen kleinen, aber entscheidenden Beitrag zu einem gigantischen Multi-Autoren-Papier, usw. â€¦.</p>
<p>Denkt zudem daran, dass es natÃ¼rlich auch noch andere Werkzeuge und ArbeitsablÃ¤ufe gibt, um etwas reproduzierbar zu machen: z.B. <a href="https://kbroman.org/minimal_make/">make</a>.</p>
</div>
</div>
<div id="readr" class="section level2" number="8.2">
<h2>
<span class="header-section-number">8.2</span> <code>readr</code><a class="anchor" aria-label="anchor" href="#readr"><i class="fas fa-link"></i></a>
</h2>
<p>Zur Einlesen und Ausgeben von DatensÃ¤tzen verwenden wir das <a href="https://readr.tidyverse.org">readr</a> Paket, welches Alternativen zu den Standardfunktionen <code><a href="https://rdrr.io/r/utils/read.table.html">read.table()</a></code> und <code><a href="https://rdrr.io/r/utils/write.table.html">write.table()</a></code> bietet. <code>readr</code> ist Teil des <a href="https://tidyverse.tidyverse.org">tidyverse</a> und daher fÃ¼hren wir standardmÃ¤ÃŸig einfach wieder</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">## â”€â”€ Attaching core tidyverse packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse 2.0.0 â”€â”€</span></span>
<span><span class="co">## âœ” dplyr     1.1.4     âœ” readr     2.1.5</span></span>
<span><span class="co">## âœ” forcats   1.0.0     âœ” stringr   1.5.1</span></span>
<span><span class="co">## âœ” ggplot2   3.5.1     âœ” tibble    3.2.1</span></span>
<span><span class="co">## âœ” lubridate 1.9.3     âœ” tidyr     1.3.1</span></span>
<span><span class="co">## âœ” purrr     1.0.2     </span></span>
<span><span class="co">## â”€â”€ Conflicts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ tidyverse_conflicts() â”€â”€</span></span>
<span><span class="co">## âœ– dplyr::filter() masks stats::filter()</span></span>
<span><span class="co">## âœ– dplyr::lag()    masks stats::lag()</span></span>
<span><span class="co">## â„¹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span></code></pre></div>
<p>aus.</p>
<p><strong>Einlesen der Gapminder Daten</strong></p>
<p>Die Gapminder Daten kÃ¶nnten wir natÃ¼rlich wie zuvor Ã¼ber das Laden des <code>gapminder</code> Pakets verfÃ¼gbar machen. Da es in diesem Abschnitt aber um das Einlesen von Daten geht, versuchen wir die Daten als <code>.tsv</code> Datei (Tab getrennte Werte - so sind die Daten im Paket gespeichert) einzulesen. Aber dies bedeutet natÃ¼rlich, dass wir die entsprechende <code>.tsv</code> Datei erst mal finden mÃ¼ssen. Dabei hilft uns glÃ¼cklicherweise das <a href="https://fs.r-lib.org/index.html">fs</a> Paket.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://fs.r-lib.org">fs</a></span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">gap_tsv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://fs.r-lib.org/reference/path_package.html">path_package</a></span><span class="op">(</span><span class="st">"gapminder"</span>, <span class="st">"extdata"</span>, <span class="st">"gapminder.tsv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/gapminder/extdata/gapminder.tsv</span></span></code></pre></div>
<p>Nachdem wir jetzt den Speicherort der Datei kennen, kÃ¶nnen wir versuchen sie einzulesen.</p>
</div>
<div id="einlesen-von-daten-in-tabellenform" class="section level2" number="8.3">
<h2>
<span class="header-section-number">8.3</span> Einlesen von Daten in Tabellenform<a class="anchor" aria-label="anchor" href="#einlesen-von-daten-in-tabellenform"><i class="fas fa-link"></i></a>
</h2>
<p>Die Haupt-Funktion zum Einlesen von Daten in readr ist <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim()</a></code>. Hier verwenden wir eine Variante, <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv()</a></code>, fÃ¼r Tab getrennte Daten:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span><span class="op">(</span><span class="va">gap_tsv</span><span class="op">)</span></span>
<span><span class="co">## Rows: 1704 Columns: 6</span></span>
<span><span class="co">## â”€â”€ Column specification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span></span>
<span><span class="co">## Delimiter: "\t"</span></span>
<span><span class="co">## chr (2): country, continent</span></span>
<span><span class="co">## dbl (4): year, lifeExp, pop, gdpPercap</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## â„¹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## â„¹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="va">gapminder</span></span>
<span><span class="co">## # A tibble: 1,704 Ã— 6</span></span>
<span><span class="co">##    country     continent  year lifeExp      pop gdpPercap</span></span>
<span><span class="co">##    &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">##  1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span><span class="co">##  2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span><span class="co">##  3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span><span class="co">##  4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span><span class="co">##  5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span><span class="co">##  6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span><span class="co">##  7 Afghanistan Asia       1982    39.9 12881816      978.</span></span>
<span><span class="co">##  8 Afghanistan Asia       1987    40.8 13867957      852.</span></span>
<span><span class="co">##  9 Afghanistan Asia       1992    41.7 16317921      649.</span></span>
<span><span class="co">## 10 Afghanistan Asia       1997    41.8 22227415      635.</span></span>
<span><span class="co">## # â„¹ 1,694 more rows</span></span></code></pre></div>
<p>Wie wir sehen, wurde standardmÃ¤ÃŸig der komplette Datensatz eingelesen. Sind aber nur Teile eines Datensatzes relevant fÃ¼r die angestrebte Analyse, so besteht auch keine Notwendigkeit den kompletten Datensatz zu laden. In solchen FÃ¤llen kann man mit dem <code>col_types</code> Argument arbeiten</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gapminder_short</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span><span class="op">(</span><span class="va">gap_tsv</span>, col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols_only</a></span><span class="op">(</span></span>
<span>  country <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  continent <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_factor.html">col_factor</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_double</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  lifeExp <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_double</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gapminder_short</span></span>
<span><span class="co">## # A tibble: 1,704 Ã— 4</span></span>
<span><span class="co">##    country     continent  year lifeExp</span></span>
<span><span class="co">##    &lt;chr&gt;       &lt;fct&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1 Afghanistan Asia       1952    28.8</span></span>
<span><span class="co">##  2 Afghanistan Asia       1957    30.3</span></span>
<span><span class="co">##  3 Afghanistan Asia       1962    32.0</span></span>
<span><span class="co">##  4 Afghanistan Asia       1967    34.0</span></span>
<span><span class="co">##  5 Afghanistan Asia       1972    36.1</span></span>
<span><span class="co">##  6 Afghanistan Asia       1977    38.4</span></span>
<span><span class="co">##  7 Afghanistan Asia       1982    39.9</span></span>
<span><span class="co">##  8 Afghanistan Asia       1987    40.8</span></span>
<span><span class="co">##  9 Afghanistan Asia       1992    41.7</span></span>
<span><span class="co">## 10 Afghanistan Asia       1997    41.8</span></span>
<span><span class="co">## # â„¹ 1,694 more rows</span></span></code></pre></div>
<p>Zur Auswahl eines Teils der Variablen haben wir <code><a href="https://readr.tidyverse.org/reference/cols.html">cols_only()</a></code> verwendet. Diese Funktion erwartet bei der Auswahl der Variablen die Definition des Typs. In diesem Beispiel haben wir <code>continten</code> (anders als im Standardfall) zu einer <a href="https://r4ds.had.co.nz/factors.html">Faktorvariable</a> transformiert. Dadurch enthÃ¤lt die Variable zusÃ¤tzlich die Information Ã¼ber die verschiedenen AusprÃ¤gungen der Variable</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">gapminder_short</span><span class="op">$</span><span class="va">continent</span><span class="op">)</span></span>
<span><span class="co">## [1] "Asia"     "Europe"   "Africa"   "Americas" "Oceania"</span></span></code></pre></div>
<p>Ãœber den Tabulator Spalten in einer Datentabelle zu trennen, ist natÃ¼rlich nur eine MÃ¶glichkeit von vielen. Weitere Alternativen sind:</p>
<ul>
<li><p>Komma: <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code></p></li>
<li><p>Strichpunkt: <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv2()</a></code></p></li>
<li><p>Leerzeichen: <code><a href="https://readr.tidyverse.org/reference/read_table.html">read_table()</a></code></p></li>
<li><p>â€¦</p></li>
</ul>
<p>FÃ¼r volle FlexibilitÃ¤t bei der Angabe des Trennzeichens kann aber jederzeit direkt <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_delim()</a></code> verwendet werden.</p>
<p>Der auffÃ¤lligste Unterschied zwischen den <a href="https://readr.tidyverse.org">readr</a>-Funktionen und der Standardfunktion <code><a href="https://rdrr.io/r/utils/read.table.html">read.table()</a></code>ist, dass <a href="https://readr.tidyverse.org">readr</a> immer ein Tibble erzeugt statt eines Data Frames. Da wir Tibbles bevorzugen ist unser</p>
<blockquote>
<p>Fazit: Benutzt <code><a href="https://readr.tidyverse.org/reference/read_delim.html">readr::read_delim()</a></code> und â€œFreundeâ€.</p>
</blockquote>
<p>Die Gapminder-Daten sind zu sauber und einfach, um die groÃŸartigen Funktionen von readr zur Geltung zu bringen. Ein Blick in <a href="https://cloud.r-project.org/web/packages/readr/vignettes/readr.html">Introduction to readr</a> zeigt aber noch viele weitere AnpassungsmÃ¶glichkeiten der readr Funktionen.</p>
</div>
<div id="daten-exportieren" class="section level2" number="8.4">
<h2>
<span class="header-section-number">8.4</span> Daten exportieren<a class="anchor" aria-label="anchor" href="#daten-exportieren"><i class="fas fa-link"></i></a>
</h2>
<p>Bevor wir etwas exportieren kÃ¶nnen, mÃ¼ssen wir natÃ¼rlich (was so sicher nicht richtig ist - niemand zwingt uns dazu ğŸ˜‰) etwas berechnen, das es wert ist, exportiert zu werden. Lasst uns daher eine Zusammenfassung der maximalen Lebenserwartung auf LÃ¤nderebene erstellen.</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gap_life_exp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>life_exp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## `summarise()` has grouped output by 'country'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span>
<span><span class="va">gap_life_exp</span></span>
<span><span class="co">## # A tibble: 142 Ã— 3</span></span>
<span><span class="co">##    country     continent life_exp</span></span>
<span><span class="co">##    &lt;chr&gt;       &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">##  1 Afghanistan Asia          43.8</span></span>
<span><span class="co">##  2 Albania     Europe        76.4</span></span>
<span><span class="co">##  3 Algeria     Africa        72.3</span></span>
<span><span class="co">##  4 Angola      Africa        42.7</span></span>
<span><span class="co">##  5 Argentina   Americas      75.3</span></span>
<span><span class="co">##  6 Australia   Oceania       81.2</span></span>
<span><span class="co">##  7 Austria     Europe        79.8</span></span>
<span><span class="co">##  8 Bahrain     Asia          75.6</span></span>
<span><span class="co">##  9 Bangladesh  Asia          64.1</span></span>
<span><span class="co">## 10 Belgium     Europe        79.4</span></span>
<span><span class="co">## # â„¹ 132 more rows</span></span></code></pre></div>
<p>Das Objekt <code>gap_life_exp</code> betrachten wir nun als Zwischenergebnis, das wir fÃ¼r die Zukunft und fÃ¼r nachgelagerte Analysen oder Visualisierungen speichern wollen.</p>
<p>Die Haupt-Exportfunktion in <a href="https://readr.tidyverse.org">readr</a> ist <code><a href="https://readr.tidyverse.org/reference/write_delim.html">write_delim()</a></code>. FÃ¼r verschiedene Dateiformate gibt es auch hier wieder verschiedene Komfortfunktionen. Mithilfe von <code><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv()</a></code> kÃ¶nnen wir den Inhalt von <code>gap_life_exp</code> in einer kommagetrennten Datei abspeichern.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">gap_life_exp</span>, <span class="st">"data/gap_life_exp.csv"</span><span class="op">)</span></span></code></pre></div>
<p>Schauen wir uns die ersten paar Zeilen von <code>gap_life_exp.csv</code> an. Dazu kÃ¶nnen wir entweder die Datei Ã¶ffnen oder z.B. im Terminal <code>head</code> verwenden</p>
<div class="inline-figure"><img src="img/head_csv.png" width="100%" style="display: block; margin: auto;"></div>
<p>Das sieht recht ordentlich aus, obwohl es keine sichtbare Ausrichtung oder Trennung in Spalten gibt. HÃ¤tten wir die Basisfunktion <code><a href="https://rdrr.io/r/utils/read.table.html">read.csv()</a></code> benutzt, wÃ¼rden wir Zeilennamen und viele AnfÃ¼hrungszeichen sehen, es sei denn, wir hÃ¤tten diese Features explizit abgeschaltet. Das schÃ¶nere Standardverhalten ist daher der Hauptgrund, warum wir <code><a href="https://readr.tidyverse.org/reference/write_delim.html">readr::write_csv()</a></code> gegenÃ¼ber <code><a href="https://rdrr.io/r/utils/write.table.html">write.csv()</a></code> bevorzugen.</p>
<div class="content-box-grey">
<p><strong>Bemerkung:</strong> Es ist auch nicht wirklich fair, sich Ã¼ber den Mangel an sichtbarer Ausrichtung zu beklagen. SchlieÃŸlich erzeugen wir Dateien, die der Computer lesen soll. Falls ihr aber wirklich in der Datei â€œherumstÃ¶bernâ€ wollt, benutzt <code><a href="https://rdrr.io/r/utils/View.html">View()</a></code> in RStudio. Oder Ã¶ffnet die Datei mit einem Spreadsheet Programm (!). Aber erliegt <strong>NIE</strong> der Versuchung, dort Datenmanipulationen vorzunehmen â€¦ kehrt zurÃ¼ck zu R und schreibt dort die entsprechenden Befehle, die ihr die nÃ¤chsten 15 Mal (oder so oft wie nÃ¶tig) ausfÃ¼hren kÃ¶nnt, wenn ihr diesen Datensatz (oder DatensÃ¤tze derselben Form) importieren/bereinigen/aggregieren/exportieren wollt.</p>
</div>
</div>
<div id="daten-Ã¼ber-eine-api" class="section level2" number="8.5">
<h2>
<span class="header-section-number">8.5</span> Daten Ã¼ber eine API<a class="anchor" aria-label="anchor" href="#daten-%C3%BCber-eine-api"><i class="fas fa-link"></i></a>
</h2>
<p>APIs (Application Programming Interface) sind eine sehr nÃ¼tzliche Methode, um auf interessante Daten zuzugreifen, die online zur VerfÃ¼gung gestellt werden.</p>
<p>Anstatt einen Datensatz herunterladen zu mÃ¼ssen, ermÃ¶glichen APIs Daten direkt von bestimmten Webseiten Ã¼ber eine Schnittstelle anzufordern. Viele groÃŸe Webseiten wie <a href="https://www.earthdatascience.org/courses/earth-analytics/get-data-using-apis/intro-to-social-media-text-mining-r/">Twitter</a> und Facebook ermÃ¶glichen Ã¼ber APIs den Zugriff auf Teile ihrer Daten.</p>
<p>Wir werden die Grundlagen des Zugriffs auf eine API besprechen. Dazu benÃ¶tigt ihr aber kein Vorwissen bzgl. APIs.</p>
<div id="einfÃ¼hrung" class="section level3" number="8.5.1">
<h3>
<span class="header-section-number">8.5.1</span> EinfÃ¼hrung<a class="anchor" aria-label="anchor" href="#einf%C3%BChrung"><i class="fas fa-link"></i></a>
</h3>
<p>API ist ein allgemeiner Begriff fÃ¼r den Ort, an dem ein Computerprogramm mit einem anderen oder mit sich selbst interagiert. Wir sprechen Ã¼ber Web-APIs, bei denen zwei verschiedene Computer - ein Client und ein Server - miteinander interagieren, um Daten anzufordern bzw. bereitzustellen.</p>
<p>APIs bieten eine ausgefeilte MÃ¶glichkeit Daten von einer Webseite anzufordern. Wenn eine Webseite wie Twitter eine API einrichtet, richten sie im Wesentlichen einen Computer ein, der auf Datenanfragen wartet.</p>
<p>Sobald dieser Computer eine Datenabfrage empfÃ¤ngt, verarbeitet er die Daten selbst und sendet sie an den Computer, der sie angefordert hat. Unsere Aufgabe wird es sein R Code zu schreiben, der die Anfrage erstellt und dem Computer, auf dem die API lÃ¤uft, mitteilt, was wir benÃ¶tigen. Dieser Computer liest dann unseren Code, verarbeitet die Anfrage und gibt schÃ¶n formatierte Daten zurÃ¼ck, die mithilfe existierender R Pakete verarbeitet werden kÃ¶nnen.</p>
</div>
<div id="erstellen-von-api-abfragen-in-r" class="section level3" number="8.5.2">
<h3>
<span class="header-section-number">8.5.2</span> Erstellen von API-Abfragen in R<a class="anchor" aria-label="anchor" href="#erstellen-von-api-abfragen-in-r"><i class="fas fa-link"></i></a>
</h3>
<p>Um mit APIs in R zu arbeiten, mÃ¼ssen wir ein paar neue Pakete laden (und vorher natÃ¼rlich installieren). Konkret werden wir mit den Paketen <code>httr</code> und <code>jsonlite</code> arbeiten. Sie spielen bei der Einbindung der APIs unterschiedliche Rollen, aber beide sind unverzichtbar.</p>
<p>Vermutlich habt ihr die beiden Pakete bisher nicht installiert. Daher starten wir mit dem Installieren dieser beiden Pakete</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"httr"</span>, <span class="st">"jsonlite"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>und laden sie anschlieÃŸend</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr.r-lib.org/">httr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jeroen.r-universe.dev/jsonlite">jsonlite</a></span><span class="op">)</span></span>
<span><span class="co">## Warning: package 'jsonlite' was built under R version 4.4.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'jsonlite'</span></span>
<span><span class="co">## The following object is masked from 'package:purrr':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     flatten</span></span></code></pre></div>
</div>
<div id="unsere-erste-api-anfrage-stellen" class="section level3" number="8.5.3">
<h3>
<span class="header-section-number">8.5.3</span> Unsere erste API-Anfrage stellen<a class="anchor" aria-label="anchor" href="#unsere-erste-api-anfrage-stellen"><i class="fas fa-link"></i></a>
</h3>
<p>Der erste Schritt, um Daten von einer API zu erhalten, ist die eigentliche Anfrage in R. Diese Anfrage wird an den Server geschickt, der Ã¼ber die API verfÃ¼gt, und wenn alles reibungslos verlÃ¤uft, wird er uns eine Antwort zurÃ¼cksenden.</p>
<p>Es gibt verschiedene Arten von Anfragen, die man an einen API-Server stellen kann. Diese verschiedenen Typen von Anfragen entsprechen verschiedenen Aktionen, die der Server ausfÃ¼hren soll.</p>
<p>FÃ¼r unsere Zwecke fragen wir lediglich nach Daten, was einer <strong>GET</strong>-Anfrage entspricht. Andere Arten von Anfragen sind z.B. POST (post file) und PUT (send put request), aber diese sind fÃ¼r uns nicht von Interesse und werden wir daher nicht weiter besprechen.</p>
<p>Um eine GET-Anfrage zu erstellen, mÃ¼ssen wir die <code><a href="https://httr.r-lib.org/reference/GET.html">GET()</a></code> Funktion aus dem <code>httr</code> Paket verwenden. Die <code><a href="https://httr.r-lib.org/reference/GET.html">GET()</a></code> Funktion benÃ¶tigt als Input eine URL, die die Adresse des Servers angibt, an den die Anforderung gesendet werden soll.</p>
<p>Als Beispiel werden wir mit der <a href="http://open-notify.org/">Open Notify</a> API arbeiten, die Daten zu verschiedenen NASA-Projekten enthÃ¤lt. Mithilfe der Open Notify API kÃ¶nnen wir uns Ã¼ber den Standort der Internationalen Raumstation informieren und erfahren, wie viele Personen sich derzeit im Weltraum aufhalten.</p>
<p>Wir beginnen damit, dass wir unsere Anfrage mit der <code><a href="https://httr.r-lib.org/reference/GET.html">GET()</a></code> Funktion stellen und die URL der API angeben:</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="st">"http://api.open-notify.org/astros.json"</span><span class="op">)</span></span></code></pre></div>
<p>Die Ausgabe der Funktion <code><a href="https://httr.r-lib.org/reference/GET.html">GET()</a></code> ist eine Liste, die alle Informationen enthÃ¤lt, die vom API-Server zurÃ¼ckgegeben werden.</p>
</div>
<div id="get-ausgabe" class="section level3" number="8.5.4">
<h3>
<span class="header-section-number">8.5.4</span> <code>GET()</code> Ausgabe<a class="anchor" aria-label="anchor" href="#get-ausgabe"><i class="fas fa-link"></i></a>
</h3>
<p>Schauen wir uns an, wie die Variable <code>jdata</code> in der R-Konsole aussieht:</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jdata</span></span>
<span><span class="co">## Response [http://api.open-notify.org/astros.json]</span></span>
<span><span class="co">##   Date: 2024-11-13 21:47</span></span>
<span><span class="co">##   Status: 200</span></span>
<span><span class="co">##   Content-Type: application/json</span></span>
<span><span class="co">##   Size: 587 B</span></span></code></pre></div>
<p>Als erstes fÃ¤llt auf, dass die URL enthalten ist, an die die GET-Anfrage gesendet wurde. AuÃŸerdem erkennen wir das Datum und die Uhrzeit, zu der die Anfrage gestellt wurde, sowie die GrÃ¶ÃŸe der Antwort.</p>
<p>Die Information <code>Content-Type</code> gibt uns eine Vorstellung davon, welche Form die Daten haben. Diese spezielle Antwort besagt, dass die Daten ein JSON-Format annehmen, womit auch klar ist warum wir das Paket <code>jsonlite</code> geladen haben.</p>
<p>Der Status verdient eine besondere Aufmerksamkeit. <code>Status</code> bezieht sich auf den Erfolg oder Misserfolg der API-Anfrage, und er wird in Form einer Zahl angegeben. Die zurÃ¼ckgegebene Nummer gibt Auskunft darÃ¼ber, ob die Anfrage erfolgreich war oder nicht. Dort kÃ¶nnen auch GrÃ¼nde fÃ¼r einen mÃ¶glichen Misserfolg enthalten sein.</p>
<p>Die Zahl 200 ist das, was wir sehen wollen. Sie entspricht einem erfolgreichen Antrag, und das ist es, was wir hier haben. Eine Ãœbersicht Ã¼ber weitere Status Codes findet man z.B. auf dieser <a href="https://www.restapitutorial.com/httpstatuscodes.html">Webseite</a>.</p>
</div>
<div id="handling-json-data" class="section level3" number="8.5.5">
<h3>
<span class="header-section-number">8.5.5</span> Handling JSON Data<a class="anchor" aria-label="anchor" href="#handling-json-data"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://www.json.org/json-en.html">JSON</a> steht fÃ¼r JavaScript Object Notation. WÃ¤hrend JavaScript eine weitere Programmiersprache ist, liegt unser Schwerpunkt bei JSON auf seiner Struktur. JSON ist nÃ¼tzlich, weil es von einem Computer leicht lesbar ist, und aus diesem Grund ist es zur primÃ¤ren Art und Weise geworden, wie Daten Ã¼ber APIs transportiert werden. Die meisten APIs senden ihre Antworten im JSON-Format.</p>
<p>JSON ist als eine Reihe von SchlÃ¼ssel-Werte-Paaren formatiert, wobei ein bestimmtes Wort (â€œSchlÃ¼sselâ€) mit einem bestimmten Wert assoziiert ist. Ein Beispiel fÃ¼r diese SchlÃ¼ssel-Wert-Struktur ist unten dargestellt:</p>
<pre><code>{
    â€œnameâ€: â€œJane Doeâ€,
    â€œnumber_of_skillsâ€: 2
}</code></pre>
<p>In ihrem aktuellen Zustand sind die Daten in der Variablen <code>jdata</code> nicht verwendbar. Die Daten sind als Unicode-Rohdaten in <code>jdata</code> enthalten, und mÃ¼ssen in das JSON-Format konvertiert werden.</p>
<p>Dazu mÃ¼ssen wir zunÃ¤chst den rohen Unicode in character Daten konvertieren, die dem oben gezeigten JSON-Format Ã¤hneln. Die Funktion <code><a href="https://rdrr.io/r/base/rawConversion.html">rawToChar()</a></code> fÃ¼hrt genau diese Aufgabe aus:</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html">rawToChar</a></span><span class="op">(</span><span class="va">jdata</span><span class="op">$</span><span class="va">content</span><span class="op">)</span></span>
<span><span class="co">## [1] "{\"people\": [{\"craft\": \"ISS\", \"name\": \"Oleg Kononenko\"}, {\"craft\": \"ISS\", \"name\": \"Nikolai Chub\"}, {\"craft\": \"ISS\", \"name\": \"Tracy Caldwell Dyson\"}, {\"craft\": \"ISS\", \"name\": \"Matthew Dominick\"}, {\"craft\": \"ISS\", \"name\": \"Michael Barratt\"}, {\"craft\": \"ISS\", \"name\": \"Jeanette Epps\"}, {\"craft\": \"ISS\", \"name\": \"Alexander Grebenkin\"}, {\"craft\": \"ISS\", \"name\": \"Butch Wilmore\"}, {\"craft\": \"ISS\", \"name\": \"Sunita Williams\"}, {\"craft\": \"Tiangong\", \"name\": \"Li Guangsu\"}, {\"craft\": \"Tiangong\", \"name\": \"Li Cong\"}, {\"craft\": \"Tiangong\", \"name\": \"Ye Guangfu\"}], \"number\": 12, \"message\": \"success\"}"</span></span></code></pre></div>
<p>Die resultierende Zeichenfolge sieht zwar recht unordentlich aus, aber es liegt wirklich die JSON-Struktur vor.</p>
<p>Ausgehend von diesem character Vektor kÃ¶nnen wir nun mit <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">fromJSON()</a></code>, aus dem <code>jsonlite</code> Paket, alles in ein Listenformat transformieren.</p>
<p>Die <code><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">fromJSON()</a></code> Funktion benÃ¶tigt einen character Vektor, der die JSON-Struktur enthÃ¤lt, die wir aus der Ausgabe von <code><a href="https://rdrr.io/r/base/rawConversion.html">rawToChar()</a></code> erhalten haben. Wenn wir also diese beiden Funktionen nacheinander anwenden, erhalten wir die gewÃ¼nschten Daten in einem Format, das wir in R leicht bearbeiten kÃ¶nnen.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html">rawToChar</a></span><span class="op">(</span><span class="va">jdata</span><span class="op">$</span><span class="va">content</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">## List of 3</span></span>
<span><span class="co">##  $ people :'data.frame': 12 obs. of  2 variables:</span></span>
<span><span class="co">##   ..$ craft: chr [1:12] "ISS" "ISS" "ISS" "ISS" ...</span></span>
<span><span class="co">##   ..$ name : chr [1:12] "Oleg Kononenko" "Nikolai Chub" "Tracy Caldwell Dyson"..</span></span>
<span><span class="co">##  $ number : int 12</span></span>
<span><span class="co">##  $ message: chr "success"</span></span></code></pre></div>
<p>Die Liste <code>data</code> hat drei Elemente. Uns interessiert in erster Linie das Data Frame <code>people</code>.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">$</span><span class="va">people</span></span>
<span><span class="co">##       craft                 name</span></span>
<span><span class="co">## 1       ISS       Oleg Kononenko</span></span>
<span><span class="co">## 2       ISS         Nikolai Chub</span></span>
<span><span class="co">## 3       ISS Tracy Caldwell Dyson</span></span>
<span><span class="co">## 4       ISS     Matthew Dominick</span></span>
<span><span class="co">## 5       ISS      Michael Barratt</span></span>
<span><span class="co">## 6       ISS        Jeanette Epps</span></span>
<span><span class="co">## 7       ISS  Alexander Grebenkin</span></span>
<span><span class="co">## 8       ISS        Butch Wilmore</span></span>
<span><span class="co">## 9       ISS      Sunita Williams</span></span>
<span><span class="co">## 10 Tiangong           Li Guangsu</span></span>
<span><span class="co">## 11 Tiangong              Li Cong</span></span>
<span><span class="co">## 12 Tiangong           Ye Guangfu</span></span></code></pre></div>
<p>Also, da haben wir unsere Antwort: Zum Zeitpunkt des letzten Updates Nov 13, 2024 von R4ews befanden sich 12 Personen im Weltraum. Aber wenn ihr den Code zu einem spÃ¤teren Zeitpunkt ausprobiert, kÃ¶nnten es auch schon wieder andere Namen und eine andere Anzahl sein. Das ist einer der Vorteile von APIs - im Gegensatz zu DatensÃ¤tzen, die man im Spreadsheet Format herunterladen kann, werden sie in der Regel in Echtzeit oder nahezu in Echtzeit aktualisiert. APIs bieten somit die MÃ¶glichkeit leicht auf sehr aktuelle Daten zuzugreifen.</p>
<p>In diesem Beispiel haben wir einen sehr unkomplizierten API-Workflow durchlaufen. Die meisten APIs fordern, dass man demselben allgemeinen Muster folgt, aber dabei kÃ¶nnen die jeweilgen Aufrufe/Befehle durchaus deutlich komplexer sein.</p>
<p>In unserem Beispiel war es ausreichen nur die URL anzugeben. Aber einige APIs verlangen mehr Informationen vom Benutzer. Darauf gehen wir aber erstmal nicht weiter ein. Stattdessen fragen wir noch nach dem Ort der ISS im Moment der Abfrage</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jdata</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://httr.r-lib.org/reference/GET.html">GET</a></span><span class="op">(</span><span class="st">"http://api.open-notify.org/iss-now.json"</span>,<span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">fromJSON</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html">rawToChar</a></span><span class="op">(</span><span class="va">jdata</span><span class="op">$</span><span class="va">content</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">iss_position</span></span>
<span><span class="co">## $latitude</span></span>
<span><span class="co">## [1] "-33.6297"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $longitude</span></span>
<span><span class="co">## [1] "-118.5426"</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">timestamp</span></span>
<span><span class="co">## [1] 1731534449</span></span></code></pre></div>
<p>Diese API gibt uns die Zeit in Form von <a href="https://de.wikipedia.org/wiki/Unixzeit">Unixzeit</a> zurÃ¼ck. Unixzeit ist die Zeitspanne, die seit dem 1. Januar 1970 vergangen ist. Mithilfe der Funktion <code><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime()</a></code> aus dem <a href="https://lubridate.tidyverse.org">lubridate</a> Paket kÃ¶nnen wir die Unixzeit aber leicht umrechnen</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/as_date.html">as_datetime</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">timestamp</span><span class="op">)</span></span>
<span><span class="co">## [1] "2024-11-13 21:47:29 UTC"</span></span></code></pre></div>
<p>Damit wollen wir den Abschnitt zu APIs beenden. Macht euch bewusst, dass wir hier wirklich nur die Basics in Bezug auf APIs eingefÃ¼hrt haben. Aber hoffentlich hat euch diese EinfÃ¼hrung trotzdem ausreichend Vertrauen gegeben, sich mit einigen komplexeren und leistungsfÃ¤higeren APIs auseinanderzusetzen.</p>
</div>
</div>
<div id="weiteres-material" class="section level2" number="8.6">
<h2>
<span class="header-section-number">8.6</span> Weiteres Material<a class="anchor" aria-label="anchor" href="#weiteres-material"><i class="fas fa-link"></i></a>
</h2>
<p>Wer noch mehr zum Thema Daten Import lesen will, der soll einen Blick in das Kapitel <a href="http://r4ds.had.co.nz/data-import.html">Data import</a> im Buch <a href="https://r4ds.had.co.nz">R for Data Science</a> von Hadley Wickham und Garrett Grolemund <span class="citation">(<a href="literatur-3.html#ref-wickham2016">2016</a>)</span> werfen.</p>
<!--Packages: main link-->
<!--Packages: vignettes & CRAN/GitHub links-->
<!--Bookdowns: main link-->
<!--Bookdowns: specific chapters-->
<!--RStudio Cheat Sheets-->
<!--Blog posts, slides, & papers-->
<!--Papers/Books Cited-->
<!--Misc.-->

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="dplyr-single.html"><span class="header-section-number">7</span> Mehr zu dplyr</a></div>
<div class="next"><a href="tidy.html"><span class="header-section-number">9</span> tidy was?</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#import-export"><span class="header-section-number">8</span> Daten I/O</a></li>
<li>
<a class="nav-link" href="#%C3%BCberblick"><span class="header-section-number">8.1</span> Ãœberblick</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#daten-import"><span class="header-section-number">8.1.1</span> Daten Import</a></li>
<li><a class="nav-link" href="#daten-export"><span class="header-section-number">8.1.2</span> Daten Export</a></li>
</ul>
</li>
<li><a class="nav-link" href="#readr"><span class="header-section-number">8.2</span> readr</a></li>
<li><a class="nav-link" href="#einlesen-von-daten-in-tabellenform"><span class="header-section-number">8.3</span> Einlesen von Daten in Tabellenform</a></li>
<li><a class="nav-link" href="#daten-exportieren"><span class="header-section-number">8.4</span> Daten exportieren</a></li>
<li>
<a class="nav-link" href="#daten-%C3%BCber-eine-api"><span class="header-section-number">8.5</span> Daten Ã¼ber eine API</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#einf%C3%BChrung"><span class="header-section-number">8.5.1</span> EinfÃ¼hrung</a></li>
<li><a class="nav-link" href="#erstellen-von-api-abfragen-in-r"><span class="header-section-number">8.5.2</span> Erstellen von API-Abfragen in R</a></li>
<li><a class="nav-link" href="#unsere-erste-api-anfrage-stellen"><span class="header-section-number">8.5.3</span> Unsere erste API-Anfrage stellen</a></li>
<li><a class="nav-link" href="#get-ausgabe"><span class="header-section-number">8.5.4</span> GET() Ausgabe</a></li>
<li><a class="nav-link" href="#handling-json-data"><span class="header-section-number">8.5.5</span> Handling JSON Data</a></li>
</ul>
</li>
<li><a class="nav-link" href="#weiteres-material"><span class="header-section-number">8.6</span> Weiteres Material</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R4ews MA0009</strong>" was written by Stephan Haug. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
